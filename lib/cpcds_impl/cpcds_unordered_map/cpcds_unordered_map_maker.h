#ifndef __cplusplus
#ifndef INCLUDED_CPCDS_UNORDERED_MAP_MAKER_H
#define INCLUDED_CPCDS_UNORDERED_MAP_MAKER_H
#define __CPCDS_DEFAULT_UMR 1000
#define define_cpcds_umk(name,__k__,__v__,efunc,hfunc)struct cpcds_kvpair_##name{__k__ key;__v__ val;};typedef struct cpcds_kvpair_##name cpcds_kvpair_##name;cpcds_kvpair_##name cpcds_mk_um_kvpair_##name(__k__ key,__v__ val){cpcds_kvpair_##name pair;pair.key=key;pair.val=val;return pair;}cpcds_deque_define(cpcds_kvpair_##name)struct cpcds_um_##name{cpcds_deque_cpcds_kvpair_##name*ens;size_t size;size_t room;};typedef struct cpcds_um_##name cpcds_um_##name;cpcds_um_##name cpcds_mk_um_room_##name(size_t rm){cpcds_um_##name um;um.room=rm;um.ens=(cpcds_deque_cpcds_kvpair_##name*)malloc(rm*sizeof(cpcds_deque_cpcds_kvpair_##name));for(cpcds_deque_cpcds_kvpair_##name*it=um.ens;it!=um.ens+rm;++it){*it=cpcds_mk_deque_empty_cpcds_kvpair_##name();}return um;}cpcds_um_##name cpcds_mk_um_empty_##name(){return cpcds_mk_um_room_##name(__CPCDS_DEFAULT_UMR);}__v__ cpcds_um_get_##name(cpcds_um_##name*um,__k__ key){__v__ v;cpcds_hash_v h=hfunc(key);h%=um->room;cpcds_deque_cpcds_kvpair_##name*dq=um->ens+h;size_t lps=0;fnd:if(lps<dq->size&&!efunc(cpcds_deque_get_front_cpcds_kvpair_##name(dq).key,key)){cpcds_deque_append_cpcds_kvpair_##name(dq,cpcds_deque_pop_front_cpcds_kvpair_##name(dq));++lps;goto fnd;}if(lps<dq->size){v=cpcds_deque_get_front_cpcds_kvpair_##name(dq).val;}return v;}void cpcds_um_realloc_##name(cpcds_um_##name*um){size_t old=um->room;um->room=um->room>>2+um->room>>4;cpcds_deque_cpcds_kvpair_##name*tmp=(cpcds_deque_cpcds_kvpair_##name*)malloc(um->room*sizeof(cpcds_deque_cpcds_kvpair_##name));unsigned int h=0;for(cpcds_deque_cpcds_kvpair_##name*__it__=um->ens;__it__!=um->ens+old;++__it__){while(__it__->size>0){h=hfunc(cpcds_deque_get_front_cpcds_kvpair_##name(__it__))%um->room;cpcds_deque_append_cpcds_kvpair_##name(tmp+h,cpcds_deque_pop_front_cpcds_kvpair_##name(__it__));}}free(um->ens);um->ens=tmp;}void cpcds_um_insert_##name(cpcds_um_##name*um,__k__ key,__v__ val){cpcds_hash_v h=hfunc(key);h%=um->room;cpcds_deque_cpcds_kvpair_##name*dq=um->ens+h;size_t lps=0;while(lps<dq->size&&!efunc(cpcds_deque_get_front_cpcds_kvpair_##name(dq).key,key)){cpcds_deque_append_cpcds_kvpair_##name(dq,cpcds_deque_pop_front_cpcds_kvpair_##name(dq));++lps;}if(lps<dq->size){cpcds_deque_pop_front_cpcds_kvpair_##name(dq);}else{if(um->size==um->room){cpcds_um_realloc_##name(um);h=hfunc(key)%um->room;dq=um->ens+h;}++um->size;}cpcds_deque_append_cpcds_kvpair_##name(dq,cpcds_mk_um_kvpair_##name(key,val));}bool cpcds_um_fnd_key_##name(cpcds_um_##name*um,__k__ key){cpcds_hash_v h=hfunc(key)%um->room;cpcds_deque_cpcds_kvpair_##name*dq=um->ens+h;size_t lps=0;while(lps<dq->size&&!efunc(cpcds_deque_get_front_cpcds_kvpair_##name(dq).key,key)){cpcds_deque_append_cpcds_kvpair_##name(dq,cpcds_deque_pop_front_cpcds_kvpair_##name(dq));++lps;}return lps<dq->size;}
#define cpcds_umk_define(__k__,__v__,efunc,hfunc)define_cpcds_uom(__k__##__##__v__,__k__,__v__,efunc,hfunc)
#endif
#endif
