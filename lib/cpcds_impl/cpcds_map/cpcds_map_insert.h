#ifndef __cplusplus
#ifndef INCLUDED_CPCDS_MAP_INSERT_H
#define INCLUDED_CPCDS_MAP_INSERT_H
#define define_cpcds_mins(name,__k__,__v__,compar)cpcds_mkvpair_##name*cpcds_mscsr_##name(cpcds_mkvpair_##name*n){n=n->rc;while(n->lc!=NULL){n=n->lc;}return n;}void cpcds_map_ins_##name(cpcds_map_##name*mp,__k__ key,__v__ val){if(mp->size==0){mp->rt=(cpcds_mkvpair_##name*)malloc(sizeof(cpcds_mkvpair_##name));*mp->rt=cpcds_mk_map_mkvpair_##name(key,val,NULL,NULL,NULL);++mp->size;}else{cpcds_mkvpair_##name*n=mp->rt;cpcds_mkvpair_##name*tmp=NULL;__s:if(compar(key,n->key)<0){if(n->lc!=NULL){n=n->lc;goto __s;}else{n->lc=(cpcds_mkvpair_##name*)malloc(sizeof(cpcds_mkvpair_##name));*n->lc=cpcds_mk_map_mkvpair_##name(key,val,n,NULL,NULL);tmp=n;__cpcds_mheight_update(tmp)cpcds_map_fix_ins_##name(mp,n);++mp->size;}}else if(compar(n->key,key)<0){if(n->rc!=NULL){n=n->rc;goto __s;}else{n->rc=(cpcds_mkvpair_##name*)malloc(sizeof(cpcds_mkvpair_##name));*n->rc=cpcds_mk_map_mkvpair_##name(key,val,n,NULL,NULL);tmp=n;__cpcds_mheight_update(tmp)cpcds_map_fix_ins_##name(mp,n);++mp->size;}}else{n->val=val;}}}void cpcds_map_erase_##name(cpcds_map_##name*mp,__k__ key){if(mp->size==1){free(mp->rt);mp->rt==NULL;}else{cpcds_mkvpair_##name*n=mp->rt;__s:if(compar(n->key,key)<0){n=n->rc;goto __s;}else if(compar(n->key,key)>0){n=n->lc;goto __s;}cpcds_mkvpair_##name*p=NULL;if(n->lc==NULL&&n->rc==NULL){if(n->parent==NULL){free(mp->rt);mp->rt=NULL;}else{p=n->parent;if(n->parent->lc==n){free(n->parent->lc);p->lc=NULL;n=p;__cpcds_mheight_update(p)cpcds_map_fix_erase_##name(mp,n);}else{free(n->parent->rc);p->rc=NULL;n=p;__cpcds_mheight_update(p)cpcds_map_fix_erase_##name(mp,n);}}}else{if(n==mp->rt){if(n->lc==NULL){mp->rt=n->rc;}else if(n->rc==NULL){mp->rt=n->lc;}else{cpcds_mkvpair_##name*tmp=NULL;__rf:tmp=cpcds_mscsr_##name(n);__k__ key=tmp->key;__v__ val=tmp->val;tmp->key=n->key;tmp->val=n->val;n->key=key;n->val=val;n=tmp;if(n->rc!=NULL){goto __rf;}if(n->parent->rc==n){n->parent->rc=n->rc;p=n->parent;free(n);}else{n->parent->lc=n->lc;if(n->lc!=NULL){n->lc->parent=n->parent;}p=n->parent;free(n);}n=p;__cpcds_mheight_update(p)cpcds_map_fix_erase_##name(mp,n);}}else if(n->lc==NULL){n->rc->parent=n->parent;if(n->parent->lc==n){n->parent->lc=n->rc;n->rc->parent=n->parent;}else{n->parent->rc=n->rc;n->rc->parent=n->parent;}p=n->parent;free(n);n=p;__cpcds_mheight_update(p)cpcds_map_fix_erase_##name(mp,n);}else if(n->rc==NULL){n->lc->parent=n->parent;if(n->parent->lc==n){n->parent->lc=n->lc;n->lc->parent=n->parent;}else{n->parent->rc=n->lc;n->lc->parent=n->parent;}p=n->parent;free(n);n=p;__cpcds_mheight_update(p)cpcds_map_fix_erase_##name(mp,n);}else{cpcds_mkvpair_##name*tmp=NULL;__f:tmp=cpcds_mscsr_##name(n);__k__ key=tmp->key;__v__ val=tmp->val;tmp->key=n->key;tmp->val=n->val;n->key=key;n->val=val;n=tmp;if(n->rc!=NULL){goto __f;}if(n->parent->rc==n){n->parent->rc=n->rc;}else{n->parent->lc=n->lc;if(n->lc!=NULL){n->lc->parent=n->parent;}}p=n->parent;free(n);n=p;__cpcds_mheight_update(p)cpcds_map_fix_erase_##name(mp,n);}}}--mp->size;}__v__ cpcds_map_get_##name(cpcds_map_##name*mp,__k__ key){cpcds_mkvpair_##name*n=mp->rt;__s:if(compar(n->key,key)<0){if(n->rc!=NULL){n=n->rc;goto __s;}}else if(compar(n->key,key)>0){if(n->lc!=NULL){n=n->lc;goto __s;}}return n->val;}bool cpcds_map_fnd_##name(cpcds_map_##name*mp,__k__ key){cpcds_mkvpair_##name*node=mp->rt;__chkdir:if(compar(node->key,key)<0){if(node->rc!=NULL){node=node->rc;goto __chkdir;}}else if(compar(node->key,key)>0){if(node->lc!=NULL){node=node->lc;goto __chkdir;}}return compar(node->key,key)==0;}
#define cpcds_mins_define(__k__,__v__,compar)define_cpcds_mins(__k__##__##__v__,__k__,__v__,compar)
#endif
#endif
